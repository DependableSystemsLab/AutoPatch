#include <stdio.h>
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>

#define EINVAL 22

int prvCheckOptions(void)
{

	//uint8_t *pxNBEB;
	uint8_t *pxNBDL; //pxNetworkBuffer->xDataLength  //Get from one of the registers
	//uint8_t *pxTCPPacket = (uint8_t *)(*((uint8_t *)(frame->r1) + 24));
	uint8_t *pxTCPPacket;
	*pxTCPPacket = (uint8_t *)(*(pxTCPPacket + 24));
    	uint8_t *pxTCPHeader = (uint8_t *)(pxTCPPacket + 34);
    	//uint8_t *pucPtr = (uint8_t *)(pxTCPHeader + 20);
    	uint8_t *pucLast = (uint8_t *)((uint8_t *)(pxTCPHeader + 20) + ((((*(pxTCPHeader + 12)) >> 4) - 5) << 2));


	/* A character pointer to iterate through the option data */
 	//pucPtr = pxTCPHeader->ucOptdata;  //(uint8_t *)(pxTCPHeader + 20)
 	//pucLast = pucPtr + (((pxTCPHeader->ucTCPOffset >> 4) - 5) << 2);    //(*(pxTCPHeader + 12))
 	
 	
 	//pxNetworkBuffer->pucEthernetBuffer
 	//pxNetworkBuffer->xDataLength
 	
    	/* Validate options size calculation. */
    	// if( pucLast > ( pxNetworkBuffer->pucEthernetBuffer + pxNetworkBuffer->xDataLength ) )
    	//printf("pxNBDL: %p, pxTCPPacket: %p, pxTCPHeader: %p, pucLast: %p\n", (void*)pxNBDL, (void*)pxTCPPacket, (void*)pxTCPHeader, (void*)pucLast);
    	//printf("pxNBDL: %hhu, pxTCPPacket: %hhu, pxTCPHeader: %hhu, pucLast: %hhu\n",*pxNBDL, *pxTCPPacket, *pxTCPHeader, *pucLast);
    	//printf("pxNBDL: %u, pxTCPPacket: %u, pxTCPHeader: %u, pucLast: %u\n", *pxNBDL, *pxTCPPacket, *pxTCPHeader, *pucLast);
    	if( pucLast > ( (*(pxTCPPacket + 24)) + pxNBDL ) ){
        	return -EINVAL;
    	}
    	
    	return 1;
}
