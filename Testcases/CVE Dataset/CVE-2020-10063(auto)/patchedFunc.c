#include <stdio.h>
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include "math_extras.h"

#define EINVAL 22
#define COAP_OPTION_NO_EXT 12

// *Comment this since RapidPatch didn't consider this:
// inline bool u16_add_overflow(uint16_t a, uint16_t b, uint16_t *result)
//{
//	uint16_t c = a + b;
//
//	*result = c;
//	
//	printf("HELLLOOOOO \n");
//	
//	return c < a;
//}


int parse_Option(uint16_t *opt_len) {

  uint16_t delta;
  int r;
  //uint16_t len;
  uint16_t hdr_len;
  
  uint32_t len;

  
  if (delta > COAP_OPTION_NO_EXT) {
		/* In case 'delta' doesn't fit the option fixed header. */
		//r = decode_delta(data, *pos, pos, max_len,
		//		 delta, &delta, &hdr_len);
		
		if ((r < 0) || (r == 0 && len > COAP_OPTION_NO_EXT)) {
			return -EINVAL;
		}
		*opt_len += hdr_len;
		
		// *Comment this since RapidPatch didn't consider this:
		// if (u16_add_overflow(*opt_len, hdr_len, opt_len)) {
		//	return -EINVAL;
		//}
		
		if(len + 0xfff >= 0xffff){
			return -EINVAL;
		}
	}
}
