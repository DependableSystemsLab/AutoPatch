# Scripts
Before running any scripts, ensure the `LLVM_BUILD_DIR` environment variable is set correctly:  
For instance: `export LLVM_BUILD_DIR=~/llvm-project/build`  
These environment variables are used by the scripts to locate the LLVM build directory and the AutoPatch source code directory.  

## instrument.sh
### Overview
`instrument.sh` generates the instrumented LLVM IR for the input C file. First, it uses LLVM's clang to generate the LLVM IR for the file. After that, it builds the LLVM project with the [AutoPatchFirstPass](../LLVM%20Passes/AutoPatchFirstPass/) pass by using `ninja`. Finally, using LLVM's opt, it runs the [AutoPatchFirstPass](../LLVM%20Passes/AutoPatchFirstPass/) pass on the generated LLVM IR to produce the instrumented LLVM IR.

### Operation
Run `instrument.sh` in the shell with the input C file (e.g., the C file including the patched function) as the argument. The script will then ask whether or not it is a patched function. If it is, provide the line numbers containing the patch. If it isn't, no instrumentation will be done. Confirm the LLVM IR file is produced in the same directory as the C file.

## analysis.sh
### Overview
`analysis.sh` generates the executable object file targetting specific hardware. First, using `ninja` it builds LLVM with the [AutoPatchSecondPass](Passes/AutoPatchSecondPass/) pass. Then, it runs the [AutoPatchSecondPass](Passes/AutoPatchSecondPass/) pass on the instrumented LLVM IR to produce a new LLVM IR file. Finally, compiling using LLVM's clang, it generates the executable object file.

### Operation
Run `analysis.sh` in the shell. Provide the `.bc` IR file generated by `instrument.sh`. Provide the name of the function that was patched, and the line numbers of the patch once again. Indicate whether the patch is of type `filter` or `replace`. `filter` indicates additional checking logic to filter out bad inputs, while `replace` indicates the patch introduces new logic or calls another function. Further indicate whether the patch is of type `redirect`, `drop`, or `none`. `redirect` indicates that control returns to the patched function. `drop` indicates a return from the patched function. `none` indicates control flow continues as is. Finally, provide the CVE-id, which will name the directory the object file will be placed in. 
